
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <!-- Para m√≥viles: evita zoom accidental y habilita PWA -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>El Trapial ‚Äî Evaluaci√≥n de Riesgo para Trabajo El√©ctrico</title>

  <!-- PWA manifest + theme color (vos actualiz√°s el .json despu√©s) -->
  ./manifest.json
  <meta name="theme-color" content="#005daa">

  <style>
    :root {
      --brand-prim: #005daa;
      --brand-sec:  #ed1c24;
      --bg: #eef2f3;
      --fg: #333;
      --card: #fff;
      --muted: #6c757d;
    }
    [data-theme="dark"] {
      --bg: #0f1419; --fg: #e6e6e6; --card: #151a21; --muted: #8a94a6;
    }
    html, body { background: var(--bg); color: var(--fg); }
    body { font-family: 'Segoe UI', Tahoma, sans-serif; padding: 10px; margin:0; }
    .card { background: var(--card); max-width: 720px; margin: auto; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); overflow: hidden; }
    .header-logo { background: var(--card); padding: 18px 20px; display: flex; align-items: center; gap: 12px; border-bottom: 4px solid var(--brand-prim); }
    .brand-name { color: var(--brand-prim); font-weight: 800; font-size: 1.2em; letter-spacing: 0.3px; }
    .content { padding: 20px; }
    h2 { color: var(--brand-prim); text-align: center; font-size: 1.25em; border-bottom: 1px solid #eee; padding-bottom: 10px; }
    h3 { color: var(--brand-prim); font-size: 1.05em; margin-top: 18px; }
    label { font-weight: 600; display: block; margin-top: 12px; font-size: 0.92em; }
    input, select { width: 100%; padding: 11px; margin-top: 6px; border: 1.4px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 1em; background: var(--card); color: var(--fg); }
    small { color:#555; display:block; }
    .calc-box { background: #f8f9fa; padding: 15px; border: 1px solid var(--brand-prim); border-radius: 8px; margin-top: 16px; }
    .calc-box h3 { color: var(--brand-prim); margin-top: 0; font-size: 1em; }
    .alerta-loto { background: var(--brand-sec); color: white; padding: 10px; border-radius: 6px; margin-top: 10px; font-weight: bold; display: none; text-align: center; }

    #signature-pad { border: 1px solid #333; background: #fff; width: 100%; height: 160px; margin-top: 10px; touch-action: none; }
    .btn-row { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
    .btn { flex: 1; padding: 12px; background: var(--brand-prim); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1em; }
    .btn-secondary { background: var(--muted); color: #fff; }
    .btn-danger { background: var(--brand-sec); }
    .btn-ghost { background: transparent; color: var(--brand-prim); border: 1px solid var(--brand-prim); }

    #res-display { margin-top: 16px; padding: 16px; border-radius: 8px; display: none; border: 2px solid; text-align: left; }
    .disclaimer { font-size: 0.78em; color: #222; background: #fff3cd; border: 1px solid #ffeeba; padding: 10px; border-radius: 6px; margin-top: 12px; }
    .checklist { margin-top: 8px; font-size: 0.92em; }
    .checklist label { font-weight: normal; display: flex; align-items: center; gap: 8px; }

    .vit-grid { margin-top:8px; border:1px dashed #bbb; padding:10px; border-radius:8px; background:#fcfcfc; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }

    .tag-row { display:flex; gap:8px; align-items:center; margin-top:8px; }
    .tag-row input { flex:1; }
    .mode-toggle { margin-left:auto; }

    .etiqueta-box { margin-top:16px; border: 2px solid #000; border-radius:14px; background:#fff; }
    .etiqueta-header { background:#d32f2f; color:#fff; padding:10px 16px; border-radius:12px 12px 0 0; font-weight:900; font-size:1.3em; text-align:center; letter-spacing:1px; }
    .etiqueta-body { display:grid; grid-template-columns: 1fr 2fr 1fr; gap:0; align-items:stretch; border-top:3px solid #000; }
    .etq-col { padding:12px; min-height:200px; border-right:2px solid #000; }
    .etq-col:last-child { border-right:none; }
    .etq-titulo { font-weight:800; margin-bottom:8px; text-align:center; }
    .etq-item { display:flex; justify-content:space-between; margin:6px 0; }
    .etq-item b { min-width:58%; }
    .etq-pict { display:flex; align-items:center; justify-content:center; font-size:2.4em; }
    .etq-footer { padding:8px 12px; border-top:2px solid #000; display:flex; justify-content:space-between; align-items:center; font-weight:700; }
    .etq-dato-rojo { color:#c62828; font-weight:800; }
    .etq-cat { color:#c62828; font-weight:900; }
    .etq-acc { margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; }

    .help { font-size:0.82em; color:#444; }
    .chip { display:inline-block; background:#e3f2fd; border:1px solid #90caf9; color:#0d47a1; padding:4px 8px; border-radius:999px; font-size:0.85em; margin-top:6px; }

    /* ===== MODAL de ayuda ===== */
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,0.6);
      display: none; align-items: center; justify-content: center; z-index: 9999;
    }
    .modal {
      background: #fff; color:#111; max-width: 640px; width: 92%;
      border-radius: 12px; box-shadow: 0 12px 32px rgba(0,0,0,0.35);
      padding: 18px; position: relative;
    }
    .modal h4 { margin: 0 0 8px 0; color: var(--brand-prim); }
    .modal .close-btn {
      position:absolute; right: 12px; top: 12px; border:none; background:transparent;
      font-size: 1.2em; cursor:pointer; color:#444;
    }
    .modal ul { margin:8px 0 0 18px; }
    .info-btn {
      display:inline-block; margin-left:8px; padding:4px 8px; font-size:0.9em;
      border:1px solid var(--brand-prim); color: var(--brand-prim); border-radius:8px; background: #fff;
      cursor:pointer;
    }
  </style>
</head>
<body>

<div class="card" id="appCard" data-theme="light">
  <div class="header-logo" aria-label="Encabezado El Trapial">
    <span class="brand-name">EL TRAPIAL ‚Äî Evaluaci√≥n de Riesgo para Trabajo El√©ctrico</span>
    <button class="btn btn-ghost mode-toggle" id="btnMode">üåô Modo oscuro</button>
  </div>

  <div class="content">
    <h2>Evaluaci√≥n preliminar de arco el√©ctrico, choque y generaci√≥n de etiqueta</h2>

    <!-- Identificaci√≥n -->
    <label for="nombre">Nombre del Operador:</label>
    <input type="text" id="nombre" autocomplete="name" placeholder="Ej: J. Perusini"/>
    <label for="equipo">Equipo / Tag / Activo:</label>
    <input type="text" id="equipo" placeholder="Ej: MCC-03 / Tablero 480V"/>

    <!-- Tipo de tarea y LOTO -->
    <label for="tipo">Tipo de Tarea:</label>
    <select id="tipo" onchange="verificarTarea()" aria-label="Tipo de tarea">
      <option value="Inspeccion">Inspecci√≥n Visual</option>
      <option value="Medicion">Medici√≥n / Pruebas de Voltaje</option>
      <option value="Contacto">Trabajo a Contacto (Mantenimiento)</option>
    </select>
    <div id="alertaPeligro" class="alerta-loto">‚ö†Ô∏è REGLA QUE SALVA VIDAS: REQUIERE AISLAMIENTO Y BLOQUEO (LOTO)</div>

    <!-- Par√°metros el√©ctricos mejorados -->
    <div class="calc-box">
      <h3>üìà Par√°metros para c√°lculo</h3>
      <div class="row">
        <div>
          <label for="volt">Tensi√≥n del sistema (V L-L):</label>
          <input type="number" id="volt" placeholder="Ej: 400 / 440 / 480" step="1" min="100"/>
          <small class="help">Usamos este valor como tensi√≥n secundaria (VLL) para calcular el corto.</small>
        </div>
        <div>
          <label for="dist">Distancia de trabajo (cm):</label>
          <input type="number" id="dist" placeholder="Ej: 61" step="1" min="1"/>
        </div>
      </div>

      <h3>‚öôÔ∏è Transformador (solo potencia)
        <button class="info-btn" id="btnInfoZ">‚ÑπÔ∏è Z% t√≠pica</button>
      </h3>
      <div class="row">
        <div>
          <label for="kva">Potencia del transformador (kVA):</label>
          <input type="number" id="kva" placeholder="10‚Äì1000" step="1" min="10" max="1000"/>
          <small class="help">La impedancia (Z%) se asigna autom√°ticamente seg√∫n el rango t√≠pico.</small>
        </div>
        <div>
          <label>Impedancia utilizada (Z%):</label>
          <input type="text" id="zpct_view" readonly value="‚Äî"/>
          <small class="help">Valor t√≠pico seg√∫n el rango de kVA. Puede diferir del valor de placa (estimaci√≥n preliminar).</small>
        </div>
      </div>

      <h3>üõ°Ô∏è Dispositivo de protecci√≥n (gen√©rico)
        <button class="info-btn" id="btnInfoDP">‚ÑπÔ∏è Info DP</button>
      </h3>
      <div class="row">
        <div>
          <label for="dp_tipo_gen">Tipo de protecci√≥n:</label>
          <select id="dp_tipo_gen">
            <option value="MCCB_CHICO">MCCB peque√±o (‚â§250 A)</option>
            <option value="MCCB_MEDIO">MCCB mediano (250‚Äì630 A)</option>
            <option value="FUSIBLE_J">Fusible Clase J</option>
            <option value="FUSIBLE_RK5">Fusible Clase RK5</option>
            <option value="DISY_GRANDE">Disyuntor industrial (>630 A)</option>
            <option value="OTRO">Otro (editar manual)</option>
          </select>
          <span id="dp_chip" class="chip">t=‚Äî s ‚Ä¢ kA=‚Äî</span>
        </div>
        <div>
          <label><input type="checkbox" id="dp_avanzado"/> Editar valores avanzados (t/kA)</label>
          <div class="row" id="dp_avanzado_box" style="display:none; margin-top:8px;">
            <div>
              <label for="tiempo">Tiempo de despeje (s):</label>
              <input type="number" id="tiempo" placeholder="Ej: 0.015" step="0.001" min="0.005"/>
            </div>
            <div>
              <label for="dp_kA">Capacidad interruptiva (kA):</label>
              <input type="number" id="dp_kA" placeholder="Ej: 36" step="1" min="1"/>
            </div>
          </div>
        </div>
      </div>

      <div class="disclaimer">
        ‚ö†Ô∏è Este c√°lculo es <strong>estimativo</strong> y no reemplaza el estudio de arco <strong>IEEE 1584</strong> ni las etiquetas oficiales.
        La selecci√≥n de EPP por <strong>categor√≠as NFPA 70E</strong> se muestra como <em>orientativa</em> cuando el m√©todo principal es por energ√≠a incidente.
        Use siempre el m√©todo <strong>√∫nico</strong> por equipo (tablas <strong>o</strong> EI) y siga permisos/LOTO.
      </div>
    </div>

    <!-- Firma -->
    <label>Firma Digital de Conformidad:</label>
    <canvas id="signature-pad" aria-label="√Årea de firma"></canvas>
    <div class="btn-row">
      <button class="btn btn-secondary" id="btnClear">Borrar Firma</button>
      <button class="btn btn-secondary" id="btnSaveSig">Guardar Firma</button>
    </div>

    <!-- VIT (Verificaci√≥n para Inicio de Trabajo) el√©ctrica -->
    <h3>‚úÖ VIT ‚Äî Verificaciones para el inicio del trabajo (El√©ctrico)</h3>
    <div class="vit-grid">
      <div class="checklist">
        <label><input type="checkbox" id="vit1"/> Alcance del trabajo revisado y aceptado (permiso/plan).</label>
        <label><input type="checkbox" id="vit2"/> El circuito/equipo a intervenir est√° identificado en el plan.</label>
        <label><input type="checkbox" id="vit3"/> EPP calificado (peligros el√©ctricos, tensi√≥n/arco) inspeccionado y sin da√±os.</label>
        <label><input type="checkbox" id="vit4"/> Barreras colocadas y acceso restringido controlado.</label>
        <label><input type="checkbox" id="vit5"/> Guardia el√©ctrica presente (si aplica) y responsabilidades acordadas.</label>
        <label><input type="checkbox" id="vit6"/> Plan de comunicaci√≥n acordado y probado con el equipo.</label>
        <label><input type="checkbox" id="vit7"/> Herramientas aisladas/equipos de prueba certificados e inspeccionados.</label>
        <label><input type="checkbox" id="vit8"/> Plan de respuesta ante emergencias listo y materiales en sitio.</label>
      </div>
      <small class="help">La etiqueta y el c√°lculo s√≥lo se habilitan si todas las verificaciones est√°n OK.</small>
    </div>

    <!-- Acciones -->
    <div class="btn-row">
      <button class="btn" id="btnCalcular">VALIDAR TRABAJO Y CALCULAR</button>
      <button class="btn btn-danger" id="btnDescargar">Descargar Reporte</button>
      <button class="btn btn-secondary" id="btnGuardarRegistro">Guardar Registro</button>
      <button class="btn btn-secondary" id="btnCargarRegistro">Cargar √öltimo</button>
      <!-- Reemplaza ‚ÄúBuscar etiqueta‚Äù por ‚ÄúCrear etiqueta‚Äù -->
      <button class="btn" id="btnCrearEtiqueta">CREAR ETIQUETA</button>
    </div>

    <!-- Resultados -->
    <div id="res-display" role="status" aria-live="polite"></div>

    <!-- Contenedor etiqueta generada -->
    <div id="etiqueta-container" class="etiqueta-box" style="display:none;">
      <div class="etiqueta-header">‚ö†Ô∏è DANGER</div>
      <div class="etiqueta-body">
        <div class="etq-col etq-pict">‚ö°</div>
        <div class="etq-col">
          <div class="etq-titulo">Peligro de Arco El√©ctrico y de Descarga</div>
          <div class="etq-item"><b>L√≠mite de Protecci√≥n Arco El√©ctrico</b><span id="etq-afb">‚Äî</span></div>
          <div class="etq-item"><b>Energ√≠a Incidente (cal/cm¬≤)</b><span id="etq-ei" class="etq-dato-rojo">‚Äî</span></div>
          <div class="etq-item"><b>Distancia de Trabajo</b><span id="etq-dist">‚Äî</span></div>
          <div class="etq-item"><b>Nivel Requerido de EPP</b><span id="etq-cat" class="etq-cat">‚Äî</span></div>

          <div class="etq-item"><b>Tensi√≥n de Peligro de Choque</b><span id="etq-vac" class="etq-dato-rojo">‚Äî</span></div>
          <div class="etq-item"><b>Acercamiento Limitado</b><span id="etq-lim">‚Äî</span></div>
          <div class="etq-item"><b>Acercamiento Restringido</b><span id="etq-res">‚Äî</span></div>
        </div>
        <div class="etq-col etq-pict">‚ö°</div>
      </div>
      <div class="etq-footer">
        <span id="etq-equipo">Equipo ‚Äî</span>
        <span id="etq-fecha">‚Äî</span>
      </div>
      <div class="etq-acc">
        <button class="btn" id="btnValidarEtiqueta">VALIDAR</button>
        <button class="btn btn-secondary" id="btnGuardarEtiqueta">Guardar etiqueta (HTML)</button>
        <button class="btn btn-secondary" id="btnEnviarEtiqueta">Enviar por email</button>
      </div>
    </div>
  </div>
</div>

<!-- ===== MODAL GEN√âRICO ===== -->
<div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <button class="close-btn" id="modalClose" aria-label="Cerrar">‚úñ</button>
    <h4 id="modalTitle">Ayuda</h4>
    <div id="modalContent">
      <!-- contenido din√°mico -->
    </div>
  </div>
</div>

<script>
  /* ===== Manifest correcto (vos actualiz√°s el .json luego) ===== */
  ./manifest.json

  // ====== Modo oscuro ======
  const appCard = document.getElementById('appCard');
  document.getElementById('btnMode').addEventListener('click', () => {
    const current = appCard.getAttribute('data-theme');
    const next = current === 'dark' ? 'light' : 'dark';
    appCard.setAttribute('data-theme', next);
    document.getElementById('btnMode').textContent = next === 'dark' ? '‚òÄÔ∏è Modo claro' : 'üåô Modo oscuro';
  });

  // ====== Firma (canvas responsivo) ======
  const canvas = document.getElementById('signature-pad');
  const ctx = canvas.getContext('2d', { willReadFrequently: true });
  let drawing = false, savedSignatureDataURL = null;

  function resizeCanvas() {
    const rect = canvas.getBoundingClientRect();
    const ratio = window.devicePixelRatio || 1;
    canvas.width = rect.width * ratio;
    canvas.height = 160 * ratio;
    canvas.style.width = rect.width + 'px';
    canvas.style.height = '160px';
    ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
    ctx.lineWidth = 2; ctx.strokeStyle = "#000";
    if (savedSignatureDataURL) {
      const img = new Image();
      img.onload = () => ctx.drawImage(img, 0, 0, canvas.width/ratio, canvas.height/ratio);
      img.src = savedSignatureDataURL;
    }
  }
  window.addEventListener('resize', resizeCanvas); setTimeout(resizeCanvas, 50);

  function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    const cx = e.touches ? e.touches[0].clientX : e.clientX;
    const cy = e.touches ? e.touches[0].clientY : e.clientY;
    return { x: cx - rect.left, y: cy - rect.top };
  }
  function startDraw(e) { drawing = true; ctx.beginPath(); const p = getPos(e); ctx.moveTo(p.x, p.y); e.preventDefault(); }
  function moveDraw(e) { if(!drawing) return; const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); e.preventDefault(); }
  function endDraw() { drawing = false; }

  canvas.addEventListener('mousedown', startDraw);
  canvas.addEventListener('mousemove', moveDraw);
  window.addEventListener('mouseup', endDraw);
  canvas.addEventListener('touchstart', startDraw, { passive: false });
  canvas.addEventListener('touchmove', moveDraw, { passive: false });
  window.addEventListener('touchend', endDraw);

  document.getElementById('btnClear').addEventListener('click', () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height); savedSignatureDataURL = null;
  });
  document.getElementById('btnSaveSig').addEventListener('click', () => {
    savedSignatureDataURL = canvas.toDataURL('image/png');
    alert('Firma guardada en memoria del navegador.');
  });

  // ====== LOTO visual ======
  function verificarTarea() {
    document.getElementById('alertaPeligro').style.display =
      (document.getElementById('tipo').value === 'Contacto') ? 'block' : 'none';
  }
  window.verificarTarea = verificarTarea;

  // ====== Tabla de impedancia t√≠pica por kVA ======
  function zPctFromKVA(kva) {
    if (kva >= 10 && kva <= 25)   return 3.5;
    if (kva >= 30 && kva <= 75)   return 4.25;
    if (kva >= 100 && kva <= 150) return 4.75;
    if (kva >= 200 && kva <= 300) return 5.25;
    if (kva >= 400 && kva <= 500) return 5.75;
    if (kva >= 630 && kva <= 750) return 5.85;
    if (kva >= 800 && kva <= 1000) return 6.5;
    return 5.75; // defecto com√∫n en industria
  }

  // ====== Tipos gen√©ricos de protecci√≥n: t y kA por defecto ======
  function dpDefaults(tipo) {
    switch (tipo) {
      case 'MCCB_CHICO':  return { t: 0.010, kA: 25 };
      case 'MCCB_MEDIO':  return { t: 0.015, kA: 36 };
      case 'FUSIBLE_J':   return { t: 0.010, kA: 100 };
      case 'FUSIBLE_RK5': return { t: 0.012, kA: 50 };
      case 'DISY_GRANDE': return { t: 0.025, kA: 50 };
      default:            return { t: null, kA: null };
    }
  }

  // ====== Estimaciones (orden de magnitud) ======
  function estimarEI(ka, t, volt, dist_cm) {
    const C = 46.2; // constante de orden de magnitud (no IEEE 1584)
    return C * ka * t * Math.pow(480/volt, 0.5) * Math.pow(45/dist_cm, 1.5);
  }
  function getPPECategory(ei) {
    if (ei <= 1.2) return "Sin categor√≠a (‚â§ 1.2 cal/cm¬≤)";
    if (ei <= 4)   return "CATEGOR√çA 1 (ATPV ‚â• 4)";
    if (ei <= 8)   return "CATEGOR√çA 2 (ATPV ‚â• 8)";
    if (ei <= 25)  return "CATEGOR√çA 3 (ATPV ‚â• 25)";
    if (ei <= 40)  return "CATEGOR√çA 4 (ATPV ‚â• 40)";
    return "CATEGOR√çA 4 (EI > 40) ‚Äî Evaluaci√≥n adicional";
  }
  function cortoDesdeTx(kva, vll, zpct) {
    const Ifl = (kva*1000)/(Math.sqrt(3)*vll); // A nominal
    const Zpu = zpct/100;
    const IscA = Ifl / Zpu; // A de corto
    return IscA/1000; // kA
  }
  function arcoBoundary(ei_work, dist_cm) {
    if (ei_work <= 0) return "‚Äî";
    const exponent = 1.5;
    const Db_cm = dist_cm * Math.pow(ei_work/1.2, 1.0/exponent);
    return (Db_cm/100).toFixed(2) + " m";
  }
  function shockBoundaries(volt) {
    if (volt <= 150) return { limited: "N/A (‚â§150 V ‚Äî evitar contacto)", restricted: "N/A" };
    if (volt <= 750) return { limited: "1.07 m", restricted: "0.30 m" };
    if (volt <= 15000) return { limited: "3.05 m", restricted: "0.81 m" };
    return { limited: "Personal calificado ‚Äî consultar tablas NFPA", restricted: "Personal calificado ‚Äî consultar tablas NFPA" };
  }

  // ====== UI: vincular kVA ‚Üí Z% y DP tipo ‚Üí t/kA por defecto ======
  const kvaInput = document.getElementById('kva');
  const zpctView = document.getElementById('zpct_view');
  const dpTipoSel = document.getElementById('dp_tipo_gen');
  const dpChip = document.getElementById('dp_chip');
  const dpAvChk = document.getElementById('dp_avanzado');
  const dpAvBox = document.getElementById('dp_avanzado_box');
  const tInput = document.getElementById('tiempo');
  const kAInput = document.getElementById('dp_kA');

  function refreshZpct() {
    const kva = parseFloat(kvaInput.value);
    if (!isFinite(kva)) { zpctView.value = "‚Äî"; return; }
    const z = zPctFromKVA(kva);
    zpctView.value = z.toFixed(2) + " %";
  }
  function refreshDPDefaults() {
    const tipo = dpTipoSel.value;
    const def = dpDefaults(tipo);
    if (tipo === 'OTRO') {
      dpChip.textContent = "t=‚Äî s ‚Ä¢ kA=‚Äî";
      dpAvChk.checked = true;
      dpAvBox.style.display = "grid";
      tInput.value = "";
      kAInput.value = "";
    } else {
      dpChip.textContent = `t=${def.t.toFixed(3)} s ‚Ä¢ kA=${def.kA}`;
      if (!dpAvChk.checked) {
        tInput.value = def.t;
        kAInput.value = def.kA;
        dpAvBox.style.display = "none";
      }
    }
  }
  kvaInput.addEventListener('input', refreshZpct);
  dpTipoSel.addEventListener('change', refreshDPDefaults);
  dpAvChk.addEventListener('change', () => {
    dpAvBox.style.display = dpAvChk.checked ? "grid" : "none";
    if (!dpAvChk.checked) refreshDPDefaults();
  });
  // Inicializar
  refreshZpct(); refreshDPDefaults();

  // ====== Estado del c√°lculo ======
  let ultimoResultado = null;

  // ====== Validaci√≥n y c√°lculo ======
  document.getElementById('btnCalcular').addEventListener('click', generarValidacion);

  function generarValidacion() {
    const nombre = document.getElementById('nombre').value.trim();
    const equipo  = document.getElementById('equipo').value.trim();
    const volt    = parseFloat(document.getElementById('volt').value);
    const dist    = parseFloat(document.getElementById('dist').value);
    const kva     = parseFloat(document.getElementById('kva').value);

    const zpct    = zPctFromKVA(kva);
    const tipoDP  = dpTipoSel.value;
    const vitOK = ['vit1','vit2','vit3','vit4','vit5','vit6','vit7','vit8'].map(id=>document.getElementById(id).checked).every(x=>x);






