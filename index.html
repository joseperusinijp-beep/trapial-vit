<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Evaluación de Riesgos para Trabajo Eléctrico</title>
    <style>
        :root { --brand: #005daa; --bg: #f0f2f5; --card: #fff; --ok: #1f8c3a; --stop: #d0021b; --warn: #ffcc00; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; }
        .card { background: var(--card); max-width: 600px; margin: auto; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); overflow: hidden; }
        .header { background: var(--brand); color: white; padding: 20px; text-align: center; font-weight: bold; text-transform: uppercase; border-bottom: 5px solid #004580; }
        .section { padding: 20px; border-bottom: 1px solid #eee; }
        .scope-box { background: #e8f4fd; border-left: 5px solid var(--brand); padding: 15px; margin-bottom: 20px; font-size: 0.9em; line-height: 1.4; }
        h3 { margin-top: 0; color: var(--brand); font-size: 1.1em; }
        label { font-weight: bold; display: block; margin-top: 15px; font-size: 0.9em; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .btn { width: 100%; padding: 16px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; text-transform: uppercase; transition: 0.2s; }
        .btn:active { transform: scale(0.98); }
        .gold-rule { background: #fff; border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; }
        .gold-rule input { width: 22px; height: 22px; flex-shrink: 0; }
        #workflow-intervencion, #workflow-inspeccion, #form-calculo, #resultado-final { display: none; }
        .etiqueta { border: 4px solid #000; margin: 15px; background: white; }
        .etq-header { background: var(--warn); padding: 10px; text-align: center; font-weight: 900; border-bottom: 4px solid #000; }
        .info-small { font-size: 0.8em; color: #666; margin-top: 4px; }
    </style>
</head>
<body>
 
<div class="card">
    <div class="header">Evaluación de Riesgos para Trabajo Eléctrico</div>
 
    <div class="section">
        <div class="scope-box">
            <strong>ALCANCE:</strong> Aplicable para mantenimiento o inspección con apertura de tableros. 
            <br><i>Nota: Si la tarea requiere recambio de componentes, debe desenergizar.</i>
        </div>
        
        <h3>1. Tipo de Tarea:</h3>
        <button class="btn" style="background: var(--brand); color: white;" onclick="setTarea('inspeccion')">Inspección / Medición (Con Tensión)</button>
        <button class="btn" style="background: #6c757d; color: white;" onclick="setTarea('intervencion')">Intervención / Recambio de Equipo</button>
    </div>
 
    <div id="workflow-intervencion" class="section">
        <h3 style="color: var(--stop);">⚠️ AISLAR INSTALACIÓN Y APLICAR REGLAS DE ORO</h3>
        <p style="font-size: 0.9em;">Marque el cumplimiento para proceder:</p>
        <div class="gold-rule"><input type="checkbox" class="gold-chk"> 1. Corte efectivo de fuentes.</div>
        <div class="gold-rule"><input type="checkbox" class="gold-chk"> 2. Enclavamiento / Bloqueo (LOTO).</div>
        <div class="gold-rule"><input type="checkbox" class="gold-chk"> 3. Verificación ausencia de tensión.</div>
        <div class="gold-rule"><input type="checkbox" class="gold-chk"> 4. Puesta a tierra y cortocircuito.</div>
        <div class="gold-rule"><input type="checkbox" class="gold-chk"> 5. Señalización zona de trabajo.</div>
        <button class="btn" style="background: var(--ok); color: white;" onclick="validarLOTO()">Confirmar Bloqueo</button>
    </div>
 
    <div id="workflow-inspeccion" class="section">
        <h3>2. Lugar de la Medición:</h3>
        <button class="btn" style="background: #fff; border: 2px solid var(--brand); color: var(--brand);" onclick="setZona('cabecera')">Entre Trafo y Barras (Cabecera)</button>
        <div class="info-small">E.I. depende de Potencia Tx, %Z y Distancia.</div>
        
        <button class="btn" style="background: #fff; border: 2px solid var(--brand); color: var(--brand);" onclick="setZona('circuito')">Aguas Abajo de Protecciones</button>
        <div class="info-small">E.I. depende de la actuación del fusible/térmica local.</div>
    </div>
 
    <div id="form-calculo" class="section" style="background: #fcfcfc;">
        <h3 id="titulo-calculo">Datos Técnicos</h3>
        
        <div id="campos-trafo">
            <label>Potencia Transformador (kVA):</label>
            <input type="number" id="kva" value="500">
            <label>Impedancia Trafo (%Z):</label>
            <input type="number" id="zpct" value="5" step="0.1">
            <label>Distancia Trafo a Tablero (metros):</label>
            <input type="number" id="distancia" value="10">
            <div class="info-small">Considera resistencia de cables típicos.</div>
        </div>
 
        <div id="campos-proteccion">
            <label>Protección Actuante:</label>
            <select id="tiempo_sel">
                <option value="0.01">Fusible NH gG (Rápido - 10ms)</option>
                <option value="0.05">Fusible NH gG (Medio - 50ms)</option>
                <option value="0.1">Interruptor Automático (100ms)</option>
                <option value="0.2">Interruptor (Lento - 200ms)</option>
            </select>
        </div>
 
        <button class="btn" style="background: var(--brand); color: white;" onclick="ejecutarCalculo()">Evaluar Riesgo de Arco</button>
    </div>
 
    <div id="resultado-final" class="etiqueta">
        <div class="etq-header">RESULTADO DE SEGURIDAD</div>
        <div style="padding: 15px;">
            <p>Energía Incidente Est.: <strong id="res-ei"></strong> cal/cm²</p>
            <div id="res-cat" style="font-size: 1.8em; font-weight: 900; text-align: center; margin: 10px 0;"></div>
            <div id="res-epp" style="background: #eee; padding: 10px; border-radius: 5px; font-size: 0.85em; border-left: 4px solid var(--brand);"></div>
        </div>
        <button class="btn" style="background: #333; color: white; border-radius: 0;" onclick="location.reload()">Reiniciar Evaluación</button>
    </div>
</div>
 
<script>
    let zonaActual = '';
 
    function setTarea(tipo) {
        document.getElementById('workflow-intervencion').style.display = tipo === 'intervencion' ? 'block' : 'none';
        document.getElementById('workflow-inspeccion').style.display = tipo === 'inspeccion' ? 'block' : 'none';
        document.getElementById('form-calculo').style.display = 'none';
        document.getElementById('resultado-final').style.display = 'none';
    }
 
    function setZona(zona) {
        zonaActual = zona;
        document.getElementById('form-calculo').style.display = 'block';
        document.getElementById('campos-trafo').style.display = 'block';
        document.getElementById('titulo-calculo').innerText = zona === 'cabecera' ? 'Datos de Cabecera' : 'Datos de Circuito';
        
        // Si es circuito, la protección es lo principal. Si es cabecera, manda el trafo.
        document.getElementById('campos-proteccion').style.display = 'block'; 
        window.scrollTo(0, document.body.scrollHeight);
    }
 
    function validarLOTO() {
        const checks = document.querySelectorAll('.gold-chk');
        if (Array.from(checks).every(c => c.checked)) {
            alert("✅ REGLAS DE ORO CUMPLIDAS. Puede proceder con la intervención física bloqueada.");
        } else {
            alert("❌ ¡ALTO! Debe marcar el cumplimiento de las 5 Reglas de Oro.");
        }
    }
 
    function ejecutarCalculo() {
        const kva = parseFloat(document.getElementById('kva').value);
        const z = parseFloat(document.getElementById('zpct').value) / 100;
        const d = parseFloat(document.getElementById('distancia').value);
        const t = parseFloat(document.getElementById('tiempo_sel').value);
        const v = 380;
 
        // 1. Corriente en bornes del Trafo
        let ik_trafo = (kva / (1.732 * (v/1000))) / z;
 
        // 2. Efecto de la distancia (Impedancia de cables est.)
        // Agregamos una impedancia de cable de aprox 0.02 ohms/100m para el cálculo
        let r_cable = (0.015 * d) / 100; 
        let ik_real = ik_trafo / (1 + (ik_trafo * r_cable / v));
        let ik_ka = ik_real / 1000;
 
        // 3. Energía Incidente (IEEE 1584 simplificado d=61cm)
        let ei = 46.2 * ik_ka * t * 1.473 * Math.pow(45/61, 1.5);
        
        // Mostrar Resultados
        document.getElementById('resultado-final').style.display = 'block';
        document.getElementById('res-ei').innerText = ei.toFixed(2);
        
        let cat = ""; let epp = ""; let color = "";
 
        if (ei <= 1.2) {
            cat = "CATEGORÍA 1"; color = var(--ok);
            epp = "Mameluco FR (4 cal), casco, gafas, guantes de cuero.";
        } else if (ei <= 8) {
            cat = "CATEGORÍA 2"; color = "#e67e22";
            epp = "Mameluco FR (8 cal), careta arc flash con balaclava, guantes dieléctricos con protector.";
        } else {
            cat = "PELIGRO: SWA"; color = var(--stop);
            epp = "ENERGÍA EXTREMA. No trabajar con tensión. Desenergice el equipo.";
        }
 
        const catDiv = document.getElementById('res-cat');
        catDiv.innerText = cat;
        catDiv.style.color = color;
        document.getElementById('res-epp').innerText = epp;
        window.scrollTo(0, document.body.scrollHeight);
    }
</script>
</body>
</html>
 

