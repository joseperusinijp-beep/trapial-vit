<label for="tipo_seleccion">Origen de Datos:</label>
<select id="tipo_seleccion" onchange="toggleManualInput()">
  <option value="manual">Entrada Manual (Cualquier equipo del yacimiento)</option>
  <option value="set_noc">SET NOC SUR (Datos del Estudio 25110.0-E4)</option>
</select>

<div id="selector_noc_container" style="display:none; margin-top:10px;">
  <label for="equipo_lista">Seleccionar Tablero Validado:</label>
  <select id="equipo_lista" onchange="cargarDatosSETNOC()">
    <option value="">-- Seleccione un tablero --</option>
    <option value="PLAYA_N1">1. TAB SECC PLAYA N1 (8 kA / 0.15s)</option>
    <option value="SERV_AUX">2. TAB SERV AUX CA-CC (6 kA / 0.15s)</option>
    <option value="SHELTER">3. TAB SECC SHELTER (5 kA / 0.1s)</option>
    <option value="CARG_BAT">4. TAB CARG BAT 110VCC (5 kA / 0.1s)</option>
    <option value="REFRIG">5/6. TAB REFRIG T1/T2 (5 kA / 0.1s)</option>
    <option value="UPS">7. TAB UPS (5 kA / 0.1s)</option>
  </select>
</div>

<script>
  [span_6](start_span)[span_7](start_span)// Base de datos técnica del estudio 25110.0-E4-MC-501-05[span_6](end_span)[span_7](end_span)
  const DB_SET_NOC = {
    "PLAYA_N1": { ik: 8.0, t: 0.15, v: 380, tag: "TAB SECC PLAYA N1 SET NOC" },
    "SERV_AUX": { ik: 6.0, t: 0.15, v: 380, tag: "TAB SERV AUX CA-CC SET NOC" },
    "SHELTER":  { ik: 5.0, t: 0.10, v: 380, tag: "TAB SECC SHELTER SET NOC" },
    "CARG_BAT": { ik: 5.0, t: 0.10, v: 380, tag: "TAB CARG BAT 110VCC SET NOC" },
    "REFRIG":   { ik: 5.0, t: 0.10, v: 380, tag: "TAB REFRIG T1/T2 SET NOC" },
    "UPS":      { ik: 5.0, t: 0.10, v: 380, tag: "TAB UPS SET NOC" }
  };

  function toggleManualInput() {
    const isManual = document.getElementById('tipo_seleccion').value === 'manual';
    document.getElementById('selector_noc_container').style.display = isManual ? 'none' : 'block';
    
    [span_8](start_span)// Si es SET NOC, bloqueamos campos para usar solo datos del estudio[span_8](end_span)
    const inputs = ['volt', 'tiempo', 'kva', 'zpct', 'vll'];
    inputs.forEach(id => document.getElementById(id).disabled = !isManual);
  }

  function cargarDatosSETNOC() {
    const key = document.getElementById('equipo_lista').value;
    if (!key) return;
    
    const data = DB_SET_NOC[key];
    document.getElementById('equipo').value = data.tag;
    document.getElementById('volt').value = data.v;
    document.getElementById('vll').value = data.v;
    document.getElementById('tiempo').value = data.t;
    // Valores de Tx genéricos para SET NOC (el cálculo usará Ik directo)
    document.getElementById('zpct').value = 5; 
    document.getElementById('kva').value = 500; 
  }

  // Lógica de cálculo mejorada para todo el yacimiento
  function calcularCategoriaEficaz() {
    const isManual = document.getElementById('tipo_seleccion').value === 'manual';
    let ik_final, t_final;

    if (!isManual) {
      const key = document.getElementById('equipo_lista').value;
      ik_final = DB_SET_NOC[key].ik;
      t_final = DB_SET_NOC[key].t;
    } else {
      // Cálculo basado en transformador para cualquier punto del yacimiento
      const kva = parseFloat(document.getElementById('kva').value);
      const vll = parseFloat(document.getElementById('vll').value);
      const zpct = parseFloat(document.getElementById('zpct').value);
      ik_final = (kva * 1000) / (Math.sqrt(3) * vll * (zpct / 100)) / 1000; // kA
      t_final = parseFloat(document.getElementById('tiempo').value);
    }

    const volt = parseFloat(document.getElementById('volt').value);
    const dist = parseFloat(document.getElementById('dist').value);

    [span_9](start_span)[span_10](start_span)// Ecuación simplificada IEEE 1584 / NFPA 70E para energía incidente[span_9](end_span)[span_10](end_span)
    // EI = 46.2 * Ik * t * (480/V)^0.5 * (45/D)^n
    const ei = 46.2 * ik_final * t_final * Math.pow(480 / volt, 0.5) * Math.pow(45 / dist, 1.5);
    
    return { ei, ik: ik_final, t: t_final };
  }

  // Actualiza tu función generarValidacion() para llamar a calcularCategoriaEficaz()
  // y asegúrate de que el EPP siempre recomiende CATEGORÍA 1 si EI < 1.2 cal/cm² 
  [span_11](start_span)// tal como concluye el estudio de Chevron[span_11](end_span).
</script>
