<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ART El√©ctrico Pro v3.0 - El Trapial</title>
    <style>
        :root { --brand-prim: #005daa; --bg: #eef2f3; --card: #fff; --ok: #1f8c3a; --stop: #d0021b; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; }
        .card { background: var(--card); max-width: 600px; margin: auto; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); overflow: hidden; }
        .header { background: var(--brand-prim); color: white; padding: 20px; text-align: center; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; border-bottom: 5px solid #004a88; }
        .section { padding: 20px; border-bottom: 1px solid #eee; }
        h3 { margin-top: 0; color: var(--brand-prim); font-size: 1.1em; border-left: 4px solid var(--brand-prim); padding-left: 10px; }
        label { font-weight: bold; display: block; margin-top: 15px; font-size: 0.9em; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; background: #fff; }
        .btn { width: 100%; padding: 16px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 15px; text-transform: uppercase; transition: 0.3s; font-size: 14px; }
        .check-group { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 12px; font-size: 0.9em; background: #f8f9fa; padding: 12px; border-radius: 8px; border: 1px solid #e9ecef; }
        .check-group input { width: 22px; height: 22px; flex-shrink: 0; cursor: pointer; }
        #calc-section, #vit-section, #etiqueta-final { display: none; }
        .etiqueta-estudio { border: 4px solid #000; margin: 15px; background: white; }
        .etq-header { background: #FFCC00; padding: 10px; text-align: center; font-size: 1.3em; font-weight: 900; border-bottom: 4px solid #000; color: black; }
        .epp-box { background: #f1f3f5; padding: 12px; border-left: 5px solid var(--brand-prim); margin-top: 10px; font-size: 0.9em; }
        #swa-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; color: white; text-align: center; padding: 40px 20px; }
        .badge { background: #eef; color: var(--brand-prim); padding: 2px 8px; border-radius: 4px; font-size: 0.8em; float: right; }
    </style>
</head>
<body>
 
<div class="card">
    <div class="header">ART El√©ctrico - Gesti√≥n de Riesgo</div>
 
    <div id="step1" class="section">
        <h3>1. Habilitaci√≥n de Trabajo</h3>
        <div class="check-group"><input type="checkbox" class="pre-check"> <span>PT y JSA validados y firmados en sitio.</span></div>
        <div class="check-group"><input type="checkbox" class="pre-check"> <span>Notificaci√≥n a Due√±o de Instalaci√≥n/Sala.</span></div>
        <button class="btn" style="background: var(--brand-prim); color: white;" onclick="validarPaso1()">Iniciar An√°lisis T√©cnico</button>
    </div>
 
    <div id="calc-section" class="section">
        <h3>2. Par√°metros T√©cnicos (IEEE 1584)</h3>
        
        <label>Equipo (Tag):</label>
        <input type="text" id="equipo" placeholder="Ej: TAB-PLAYA-N1" oninput="autoFillTag()">
        
        <label>Potencia Transformador (kVA):</label>
        <input type="number" id="kva" placeholder="Ej: 50, 75, 500..." oninput="sugerirZ()">
 
        <label>Impedancia (%Z): <span class="badge" id="z-msg">Sugerido</span></label>
        <input type="number" id="zpct" value="5" step="0.1">
 
        <label>Protecci√≥n (Fusible gG/gL):</label>
        <select id="fusible-sel" onchange="setFuseTime()">
            <option value="custom">Ingresar tiempo manualmente...</option>
            <option value="0.01">Fusible gG 16A a 63A (Ultra R√°pido)</option>
            <option value="0.02">Fusible gG 80A a 160A</option>
            <option value="0.05">Fusible gG 200A a 400A</option>
            <option value="0.1">Fusible gG 500A a 630A</option>
            <option value="0.15">Interruptor Termomagn√©tico (Est√°ndar)</option>
        </select>
 
        <label>Tiempo de Despeje (segundos):</label>
        <input type="number" id="tiempo" step="0.001" placeholder="Ej: 0.008">
 
        <button class="btn" style="background: var(--brand-prim); color: white;" onclick="calcular()">Calcular Energ√≠a de Arco</button>
    </div>
 
    <div id="vit-section" class="section" style="background: #e9f7ef;">
        <h3>3. Verificaci√≥n de √öltima Instancia (VIT)</h3>
        <div class="check-group"><input type="checkbox" class="vit-check"> <span>VIT El√©ctrica completada sin desv√≠os.</span></div>
        <div class="check-group"><input type="checkbox" class="vit-check"> <span>Herramientas aisladas y EPP inspeccionado.</span></div>
        <button class="btn" style="background: var(--ok); color: white;" onclick="validarPaso3()">Obtener Resultado y EPP</button>
    </div>
 
    <div id="etiqueta-final" class="etiqueta-estudio">
        <div class="etq-header">‚ö†Ô∏è RIESGO EL√âCTRICO</div>
        <div class="section" style="padding:15px;">
            <div style="display: flex; justify-content: space-between;">
                <span><b>TAG:</b> <span id="etq-tag"></span></span>
                <span><b>E.I.:</b> <span id="etq-ei" style="color:red; font-weight:bold;"></span></span>
            </div>
            <div style="text-align: center; margin: 20px 0;">
                <span id="etq-cat" style="font-size: 2.2em; font-weight: 900; color: #d0021b;"></span><br>
                <small>DISTANCIA DE SEGURIDAD (AFB): <b id="etq-afb"></b></small>
            </div>
            <div class="epp-box">
                <b>EPP REQUERIDO:</b><br>
                <span id="res-epp"></span>
            </div>
        </div>
        <button class="btn" style="background: #333; color: white; border-radius: 0; margin: 0;" onclick="enviarReporte()">üìß Reportar a Seguridad El√©ctrica</button>
    </div>
</div>
 
<div id="swa-overlay">
    <div style="border: 6px solid var(--stop); padding: 30px; border-radius: 20px; margin-top: 80px;">
        <h1 style="font-size: 4em; color: var(--stop); margin: 0;">üõë SWA</h1>
        <h2 style="letter-spacing: 2px;">ALTO RIESGO</h2>
        <p>Categor√≠a Detectada: <span id="swa-cat"></span></p>
        <p>La energ√≠a calculada supera la protecci√≥n del EPP est√°ndar. <b>NO PROCEDER CON TENSI√ìN.</b></p>
        <button class="btn" style="background: white; color: black;" onclick="location.reload()">Reevaluar Datos</button>
    </div>
</div>
 
<script>
    const ESTUDIO_SSAA = { "PLAYA": 0.08, "SHELTER": 0.05, "AUX": 0.1, "UPS": 0.05 };
    let ei = 0; let cat = ""; let afb = 0;
 
    function sugerirZ() {
        const kva = parseFloat(document.getElementById('kva').value);
        const zInput = document.getElementById('zpct');
        const msg = document.getElementById('z-msg');
        if (kva <= 75) { zInput.value = 2.5; msg.innerText = "Sugerido (Trafo Chico)"; }
        else if (kva <= 160) { zInput.value = 3.5; msg.innerText = "Sugerido (Mediano)"; }
        else { zInput.value = 5.0; msg.innerText = "Sugerido (Est√°ndar)"; }
    }
 
    function setFuseTime() {
        const sel = document.getElementById('fusible-sel').value;
        if (sel !== "custom") {
            document.getElementById('tiempo').value = sel;
        }
    }
 
    function autoFillTag() {
        const tag = document.getElementById('equipo').value.toUpperCase();
        for(let key in ESTUDIO_SSAA) {
            if(tag.includes(key)) document.getElementById('tiempo').value = ESTUDIO_SSAA[key];
        }
    }
 
    function validarPaso1() {
        if (Array.from(document.querySelectorAll('.pre-check')).every(c => c.checked)) {
            document.getElementById('calc-section').style.display = 'block';
            window.scrollTo({top: document.getElementById('calc-section').offsetTop, behavior: 'smooth'});
        } else { alert("Debe tildar los requisitos de permisos."); }
    }
 
    function calcular() {
        const v = 380; // Tensi√≥n est√°ndar fija para este an√°lisis
        const t = parseFloat(document.getElementById('tiempo').value);
        const kva = parseFloat(document.getElementById('kva').value);
        const z = parseFloat(document.getElementById('zpct').value) / 100;
        
        if (!t || !kva) { alert("Por favor, complete Potencia y Tiempo."); return; }
 
        // Corriente de falla (Isc)
        const ik = (kva / (1.732 * (v/1000))) / z / 1000;
        
        // E.I. (IEEE 1584) - d=61cm, cf=1.473 (Caja)
        ei = 46.2 * ik * t * Math.pow(480/v, 0.5) * Math.pow(45/61, 1.5) * 1.473;
        
        // Frontera (AFB)
        afb = Math.pow((46.2 * ik * t * Math.pow(480/v, 0.5) * 1.473) / 1.2, 1/1.5) * 45;
        
        cat = (ei <= 1.2) ? "1" : (ei <= 8) ? "2" : (ei <= 25) ? "3" : "4";
 
        if (parseInt(cat) >= 3) {
            document.getElementById('swa-cat').innerText = cat;
            document.getElementById('swa-overlay').style.display = "block";
        } else {
            document.getElementById('vit-section').style.display = 'block';
            window.scrollTo({top: document.getElementById('vit-section').offsetTop, behavior: 'smooth'});
        }
    }
 
    function validarPaso3() {
        if (Array.from(document.querySelectorAll('.vit-check')).every(c => c.checked)) {
            document.getElementById('etiqueta-final').style.display = "block";
            document.getElementById('etq-tag').innerText = document.getElementById('equipo').value.toUpperCase();
            document.getElementById('etq-ei').innerText = ei.toFixed(2) + " cal/cm¬≤";
            document.getElementById('etq-cat').innerText = "CATEGOR√çA " + cat;
            document.getElementById('etq-afb').innerText = (afb/100).toFixed(2) + " metros";
            
            const ppe = (cat === "1") ?
                "Mameluco FR (m√≠n. 4 cal), Casco Clase E, Protecci√≥n ocular y auditiva, Guantes de cuero." :
                "Mameluco FR (m√≠n. 8 cal), Careta Arc Flash con Balaclava (8 cal), Guantes diel√©ctricos con protector y Calzado de seguridad.";
            document.getElementById('res-epp').innerText = ppe;
            
            window.scrollTo({top: document.getElementById('etiqueta-final').offsetTop, behavior: 'smooth'});
        } else { alert("Debe confirmar la VIT."); }
    }
 
    function enviarReporte() {
        const tag = document.getElementById('equipo').value;
        const body = `REPORTE DE RIESGO EL√âCTRICO - TRAPIAL%0AEquipo: ${tag}%0AEnerg√≠a Incidente: ${ei.toFixed(2)} cal/cm¬≤%0ACategor√≠a: ${cat}%0AFrontera: ${(afb/100).toFixed(2)}m%0AVIT: OK`;
        window.location.href = `mailto:mantenimientotrapialelectrico@chevron.com?subject=An√°lisis de Arco - ${tag}&body=${body}`;
    }
</script>
</body>
</html>

