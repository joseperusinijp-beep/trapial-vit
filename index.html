<!DOCTYPE html>
<html lang="es">


<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Arc Flash Safety Control - El Trapial</title>
  <meta name="description" content="Evaluación profesional de riesgo de arco eléctrico. Incluye cumplimiento de procedimientos, permisos y VIT, y comparación por tablas NFPA 70E.">
<div class="header">
  <img src="logo.png" alt="Logo Chevron" style="height: 60px; margin-bottom: 10px;">
  <h1>Arc Flash Safety Control</h1>
  <small>Chevron Argentina — El Trapial</small>
</div>
  <!-- Favicons (desktop) -->
 
  <!-- iOS (pantalla de inicio) -->

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Trapial VIT">

  <!-- Android / PWA -->

  <meta name="theme-color" content="#005aa2">

  <style>



    :root { --blue:#005aa2; --red:#b71c1c; --gold:#ffcc00; --dark:#1a1a1a; }
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#f4f7f6;margin:0;padding:15px}
    .app-container{max-width:900px;margin:auto;background:#fff;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.15);overflow:hidden}
    .header{background:var(--blue);color:#fff;padding:22px;text-align:center;border-bottom:5px solid #003d6e}
    .header h1{margin:0;font-size:1.6rem;text-transform:uppercase;letter-spacing:1px}
    .header small{display:block;margin-top:6px;opacity:.9}
    .tabs{display:flex;gap:8px;padding:10px 10px 0;background:#f4f7f6}
    .tab{flex:1;text-align:center;padding:10px;cursor:pointer;background:#e8eef4;border-radius:10px 10px 0 0;font-weight:700;color:#003d6e;border:2px solid #d6e0ea}
    .tab.active{background:#fff;border-bottom-color:#fff}
    .section{padding:18px 24px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .input-group{margin-bottom:14px}
    label{display:block;font-weight:800;margin-bottom:6px;color:#005aa2;font-size:.9rem;text-transform:uppercase}
    input,select{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:1rem;outline:none;transition:.2s;background:#fff}
    input:focus,select:focus{border-color:#005aa2;background:#f0f7ff}
    .help{color:#555;font-size:.85rem;margin-top:6px}
    .checkbox-group{margin-bottom:10px;}
    .checkbox-group label{display:flex;align-items:center;font-weight:600;color:#333;font-size:1rem;text-transform:none;margin-bottom:4px;}
    .checkbox-group input[type="checkbox"]{margin-right:10px;width:20px;height:20px;}
    .stop-box{background:var(--red);color:#fff;padding:18px 18px 10px 18px;border-radius:12px;margin:16px 0;text-align:center;box-shadow:0 2px 12px rgba(0,0,0,0.18);display:none;}
    .stop-box h2{margin:0 0 10px 0;font-size:1.3rem;text-shadow:1px 1px 3px rgba(0,0,0,0.35);}
    .rules-checklist{text-align:left;margin-top:10px;background:rgba(0,0,0,.13);padding:12px;border-radius:8px;}
    .rule-item{display:flex;align-items:center;margin-bottom:8px;font-size:1rem;font-weight:600;cursor:pointer;}
    .rule-item input{width:20px;height:20px;margin-right:10px;cursor:pointer;}
    .btn{background:#005aa2;color:#fff;border:none;padding:14px 16px;font-size:1.05rem;font-weight:800;border-radius:10px;cursor:pointer;transition:.2s}
    .btn:disabled{background:#ccc;cursor:not-allowed}
    .btn:hover:not(:disabled){background:#003d6e;transform:translateY(-1px)}
    .btn-secondary{background:#444}
    #result-display{display:none;padding:20px;background:#eee;border-top:2px solid #ddd}
    .etiqueta{border:10px solid #000;background:#fff;max-width:600px;margin:auto}
    .et-head{padding:12px;text-align:center;font-size:2.1rem;font-weight:900;border-bottom:10px solid #000}
    .danger{background:#b71c1c;color:#fff}
    .warning{background:#ffcc00;color:#000}
    .et-body{padding:16px;text-align:center}
    .cat-value{font-size:4.2rem;font-weight:1000;border:8px solid #000;display:inline-block;padding:6px 24px;margin:12px 0;background:#f0f0f0}
    .et-row{display:flex;justify-content:space-between;gap:8px;font-size:1.05rem;border-bottom:2px solid #ddd;padding:8px 0;text-align:left}
    .footer-info{background:#333;color:#fff;padding:12px;font-size:.95rem;text-align:left}
    .disclaimer{color:#444;font-size:.85rem;margin:10px 0}
    .actions{display:flex;gap:10px;justify-content:center;margin-top:14px}
    @media print{.header,.tabs,.section .btn,.actions{display:none!important}#result-display{display:block!important;padding:0}.app-container{box-shadow:none;border:none}}
  </style>
</head>
<body>
<div class="app-container">
  <div class="header">
    <h1>Arc Flash Safety Control</h1>
    <small>Chevron Argentina — El Trapial</small>
  </div>

  <!-- Datos generales y cumplimiento -->
  <div class="section" style="background:#f8fafc;">
    <div class="grid">
      <div class="input-group">
        <label for="trabajador">Nombre del trabajador</label>
        <input type="text" id="trabajador" placeholder="Nombre y apellido" required>
      </div>
      <div class="input-group">
        <label for="fecha">Fecha y hora</label>
        <input type="datetime-local" id="fecha">
      </div>
    </div>
    <div class="checkbox-group">
      <label><input type="checkbox" id="jsa_chk"> JSA realizado y firmado</label>
      <label><input type="checkbox" id="permiso_chk"> Permiso de trabajo vigente</label>
      <label><input type="checkbox" id="vit_chk"> VIT confeccionada y firmada</label>
    </div>
  </div>

  <!-- Pestañas (MOVIDO DE ARRIBA AQUI ABAJO) -->
  <div class="tabs">
    <div id="tab_estudio" class="tab active" onclick="showPane('pane_estudio')">Con estudio (SET NOC SUR)</div>
    <div id="tab_nfpa"   class="tab"        onclick="showPane('pane_nfpa')">Sin estudio (NFPA 70E por tablas)</div>
  </div>

  <!-- Con estudio -->
  <div id="pane_estudio" class="section">
    <div class="grid">
      <div class="input-group">
        <label for="tag_id">TAG / Identificación del Equipo</label>
        <input type="text" id="tag_id" placeholder="Ej: TGD-01-NOC" autocomplete="off"/>
        <div class="help">Usá el TAG tal como figura en el tablero/equipo.</div>
      </div>
      <div class="input-group">
        <label for="task_type">Tipo de Tarea</label>
        <select id="task_type" onchange="updateUIEstudio()">
          <option value="">-- Seleccione Actividad --</option>
          <option value="estudio">Consultar Estudio SET NOC SUR</option>
          <option value="medicion">Medición o Inspección (Puerta Abierta)</option>
          <option value="maniobra">Maniobra Seccionador (Puerta Cerrada)</option>
          <option value="mantenimiento">Mantenimiento o Cambio de Componentes</option>
        </select>
      </div>
    </div>

    <div id="estudio_div" class="input-group" style="display:none;">
      <label for="tab_select">Seleccionar Tablero del Estudio</label>
      <select id="tab_select">
        <option value="playa1">TAB SECC PLAYA N°1 (0.28 cal)</option>
        <option value="ssaa">TAB SERV AUX CA-CC (0.54 cal)</option>
        <option value="shelter">TAB SECC SHELTER (0.15 cal)</option>
        <option value="cargador">TAB CARG BAT 110VCC (0.10 cal)</option>
      </select>
      <div class="help">Valores del estudio (energía incidente y distancia) — usar los del estudio sin modificarlos.</div>
    </div>

    <!-- Cartel de Reglas de Oro (solo MANTENIMIENTO) -->
    <div id="stop_card" class="stop-box" role="alert" aria-live="polite">
      <h2>¡DETENGA LA TAREA! — Aplique las 5 Reglas de Oro</h2>
      <div class="rules-checklist">
        <label class="rule-item"><input type="checkbox" class="rule-chk" onchange="updateUIEstudio()"> 1. Corte efectivo y visible</label>
        <label class="rule-item"><input type="checkbox" class="rule-chk" onchange="updateUIEstudio()"> 2. Bloqueo y Etiquetado (LOTO)</label>
        <label class="rule-item"><input type="checkbox" class="rule-chk" onchange="updateUIEstudio()"> 3. Verificar ausencia de tensión</label>
        <label class="rule-item"><input type="checkbox" class="rule-chk" onchange="updateUIEstudio()"> 4. Puesta a tierra y cortocircuito</label>
        <label class="rule-item"><input type="checkbox" class="rule-chk" onchange="updateUIEstudio()"> 5. Señalización del área</label>
      </div>
    </div>

    <div class="actions">
      <button id="btn_estudio" class="btn" onclick="generarEtiqueta('estudio')" disabled>GENERAR ETIQUETA EPP</button>
      <button class="btn btn-secondary" onclick="limpiar()">LIMPIAR</button>
    </div>
    <p class="disclaimer">
      ⚠️ Resultado <strong>estimativo</strong> que <u>no reemplaza</u> estudios IEEE 1584/NFPA 70E ni etiquetas vigentes del equipo.
    </p>
  </div>

  <!-- Sin estudio (NFPA 70E por tablas) -->
  <div id="pane_nfpa" class="section" style="display:none;">
    <h3 style="margin:6px 0 14px;">Método de Tablas NFPA 70E (≤ 600 V)</h3>
    <div class="grid">
      <div class="input-group">
        <label for="volt_nfpa">Tensión del sistema (V)</label>
        <input type="number" id="volt_nfpa" min="120" max="600" step="1" placeholder="Ej: 480" required>
      </div>
      <div class="input-group">
        <label for="scc_nfpa">Corriente de cortocircuito disponible (kA)</label>
        <input type="number" id="scc_nfpa" min="0.1" max="100" step="0.1" placeholder="Ej: 20" required>
      </div>
      <div class="input-group">
        <label for="t_nfpa">Tiempo total de despeje (s)</label>
        <input type="number" id="t_nfpa" min="0.01" max="2" step="0.01" placeholder="Ej: 0.03" required>
        <div class="help">Incluye tiempo de relé y apertura del interruptor/fusible.</div>
      </div>
    </div>
    <div class="actions">
      <button class="btn" onclick="generarEtiqueta('nfpa')">CALCULAR CATEGORÍA (TABLAS)</button>
      <button class="btn btn-secondary" onclick="limpiar()">LIMPIAR</button>
    </div>
    <p class="disclaimer">
      ⚠️ Cálculo <strong>orientativo</strong> según condiciones de tablas NFPA 70E para equipos típicos de baja tensión.  
      Si los datos no cumplen condiciones de las tablas, se requiere <b>estudio IEEE 1584</b>.
    </p>
  </div>

  <!-- Resultados / Etiqueta -->
  <div id="result-display" aria-live="polite">
    <div class="etiqueta">
      <div id="et_h" class="et-head warning">ADVERTENCIA</div>
      <div class="et-body">
        <div style="font-weight:900;font-size:1.2rem;">PELIGRO DE ARCO ELÉCTRICO</div>
        <div style="font-weight:bold;margin-top:8px;font-size:1.05rem;">CATEGORÍA DE EPP:</div>
        <div id="res_cat" class="cat-value">--</div>

        <div class="et-row"><span>Trabajador:</span> <strong id="res_trab">--</strong></div>
        <div class="et-row"><span>Fecha/hora:</span> <strong id="res_fecha">--</strong></div>
        <div class="et-row"><span>Método:</span> <strong id="res_m">--</strong></div>
        <div class="et-row"><span>Condición / Energía Incidente:</span> <strong id="res_e">--</strong></div>
        <div class="et-row"><span>Equipo / Protección:</span> <strong id="res_eq">--</strong></div>
        <div class="et-row"><span>Tiempo usado:</span> <strong id="res_t">--</strong></div>
        <div class="et-row"><span>Permisos y VIT:</span> <strong id="res_perm">--</strong></div>
      </div>
      <div id="res_desc" class="footer-info"></div>
    </div>

    <div class="actions">
      <button class="btn" onclick="window.print()">IMPRIMIR ETIQUETA</button>
      <button class="btn btn-secondary" onclick="limpiar()">NUEVA EVALUACIÓN</button>
    </div>

    <p style="text-align:center;font-weight:bold;color:#005aa2;margin-top:16px;">Reporte generado para Mantenimiento El Trapial</p>
  </div>
</div>

<script>
  // ====== Pestañas ======
  function showPane(id){
    document.getElementById('pane_estudio').style.display = (id==='pane_estudio')?'block':'none';
    document.getElementById('pane_nfpa').style.display    = (id==='pane_nfpa')?'block':'none';
    document.getElementById('tab_estudio').classList.toggle('active', id==='pane_estudio');
    document.getElementById('tab_nfpa').classList.toggle('active', id==='pane_nfpa');
    document.getElementById('result-display').style.display = 'none';
  }

  // ====== Con estudio ======
  const data_set_noc = {
    "playa1":  { e:0.28, d:0.35, t:"TAB SECC PLAYA N°1" },
    "ssaa":    { e:0.54, d:0.48, t:"TAB SERV AUX CA-CC" },
    "shelter": { e:0.15, d:0.25, t:"TAB SECC SHELTER" },
    "cargador":{ e:0.10, d:0.20, t:"TAB CARG BAT 110VCC" }
  };

  function updateUIEstudio(){
    const task = document.getElementById('task_type').value;
    const btn  = document.getElementById('btn_estudio');
    const stopCard   = document.getElementById('stop_card');
    const estudioDiv = document.getElementById('estudio_div');

    // Mostrar estudio de tableros si corresponde
    estudioDiv.style.display = (task === 'estudio') ? 'block' : 'none';
    // MOSTRAR REGLAS DE ORO SOLO EN MANTENIMIENTO
    stopCard.style.display = (task === 'mantenimiento') ? 'block' : 'none';

    // Habilitar botón
    if (task === '') {
      btn.disabled = true;
    } else if (task === 'mantenimiento') {
      const checks = document.querySelectorAll('.rule-chk:checked').length;
      btn.disabled = (checks < 5);
    } else {
      btn.disabled = false;
    }
  }

  // ====== Textos EPP por categoría ======
  function eppText(cat){
    if (cat === 1) return "<b>CAT 1:</b> Mameluco FR, careta arco, protección auditiva y guantes de cuero.";
    if (cat === 2) return "<b>CAT 2:</b> Mameluco FR, capucha FR + careta, guantes dieléctricos y protección auditiva.";
    if (cat === 3) return "<b>CAT 3:</b> Conjunto FR de ATPV mayor, capucha/visor superior, guantes dieléctricos, protección auditiva y complementos.";
    if (cat === 4) return "<b>CAT 4:</b> Arc suit (≥40 cal/cm²), capucha integral, guantes dieléctricos y accesorios completos.";
    return "<b>PELIGRO EXTREMO:</b> EI > 40 cal/cm². No intervenir. Mitigar/aislar, revisar protecciones.";
  }
  function eppCategoryByEnergy(E){
    if (E > 40) return 'EXTREMO';
    if (E > 25) return 4;
    if (E > 8)  return 3;
    if (E > 1.2) return 2;
    return 1;
  }

  // ====== Render de etiqueta ======
  function renderResult({trabajador, fecha, metodo, energia, dist, equipo, tiempo, cat, permisosTxt}){
    document.getElementById('result-display').style.display = 'block';
    document.getElementById('res_trab').innerText = trabajador || "—";
    document.getElementById('res_fecha').innerText = fecha || "—";
    document.getElementById('res_m').innerText  = metodo || "—";
    document.getElementById('res_e').innerText  = (energia!=null ? energia.toFixed(2) + " cal/cm²" : dist || "—");
    document.getElementById('res_eq').innerText = equipo || "—";
    document.getElementById('res_t').innerText  = (tiempo!=null ? tiempo.toFixed(3) + " s" : "—");
    document.getElementById('res_perm').innerText = permisosTxt || "—";
    document.getElementById('res_cat').innerText = (cat==='EXTREMO') ? "NO INTERVENIR" : ("CAT " + cat);
    document.getElementById('res_desc').innerHTML = eppText(cat);

    const danger = (cat==='EXTREMO') || (typeof cat==='number' && cat>=3) || (energia && energia>8);
    const h = document.getElementById('et_h');
    h.innerText = danger ? "PELIGRO" : "ADVERTENCIA";
    h.className = "et-head " + (danger ? "danger" : "warning");

    window.scrollTo({ top: document.body.scrollHeight, behavior:'smooth' });
  }

  // ====== Generar etiqueta (ambos modos) ======
  function generarEtiqueta(modo){
    // Validación de datos generales
    const trabajador = (document.getElementById('trabajador').value || '').trim();
    let fecha = document.getElementById('fecha').value;
    if (!fecha){
      const now = new Date();
      const tzoffset = now.getTimezoneOffset() * 60000;
      fecha = new Date(now - tzoffset).toISOString().slice(0,16);
      document.getElementById('fecha').value = fecha;
    }
    const jsa = document.getElementById('jsa_chk').checked;
    const permiso = document.getElementById('permiso_chk').checked;
    const vit = document.getElementById('vit_chk').checked;

    if(!trabajador){
      alert("Debes ingresar el nombre del trabajador.");
      return;
    }
    if(!jsa || !permiso || !vit){
      alert("Debes confirmar JSA, Permiso y VIT para generar la etiqueta.");
      return;
    }
    const permisosTxt = `${jsa?'JSA ✔':'JSA ✖'} • ${permiso?'Permiso ✔':'Permiso ✖'} • ${vit?'VIT ✔':'VIT ✖'}`;

    // ----- Modo CON ESTUDIO -----
    if (modo === 'estudio'){
      const task = document.getElementById('task_type').value;
      if (!task){ alert("Seleccioná el tipo de tarea."); return; }

      // Si es mantenimiento, exigir las 5 Reglas de Oro
      if (task === 'mantenimiento'){
        const checks = document.querySelectorAll('.rule-chk:checked').length;
        if (checks < 5){
          alert("Para mantenimiento, deben marcarse las 5 Reglas de Oro.");
          return;
        }
      }

      const tagInput = (document.getElementById('tag_id').value || '').trim();
      let e, d, tag;
      if (task === 'estudio'){
        const val = document.getElementById('tab_select').value;
        const src = data_set_noc[val];
        e = src.e; d = src.d; tag = src.t;
      } else {
        e = 1.10; d = 0.50; tag = tagInput || "EQUIPO EN CAMPO";
      }
      const cat = eppCategoryByEnergy(e);
      renderResult({
        trabajador, fecha,
        metodo:'Con estudio (SET NOC SUR)',
        energia:e,
        dist:`Distancia estudio: ${d.toFixed(2)} m`,
        equipo:tag,
        tiempo:null,
        cat, permisosTxt
      });
      return;
    }

    // ----- Modo NFPA 70E por tablas (solo V, Icc, t) -----
    const V   = parseFloat(document.getElementById('volt_nfpa').value);
    const Icc = parseFloat(document.getElementById('scc_nfpa').value);
    const t   = parseFloat(document.getElementById('t_nfpa').value);

    if (!V || !Icc || !t){ alert("Completá tensión (V), Icc (kA) y tiempo de despeje (s)."); return; }
    if (V > 600){
      renderResult({
        trabajador, fecha,
        metodo:'NFPA 70E por tablas',
        energia:null,
        dist:'—',
        equipo:`Sistema ${V} V • Icc ${Icc} kA`,
        tiempo:t,
        cat:'EXTREMO',
        permisosTxt
      });
      document.getElementById('res_desc').innerHTML =
        "<b>No válido:</b> el método de tablas aplica a ≤600 V. Requiere estudio IEEE 1584.";
      return;
    }

    // Comparación con condiciones (resumen conservador) de NFPA 70E para equipos ≤600 V
    let categoria = null, condicion = '';
    if (V <= 240 && Icc <= 25 && t <= 0.03) {
      categoria = 1; condicion = 'Panel ≤240 V, Icc ≤25 kA, t ≤0,03 s';
    } else if (V > 240 && V <= 600 && Icc <= 65 && t <= 0.03) {
      categoria = 2; condicion = 'Panel 208–600 V, Icc ≤65 kA, t ≤0,03 s';
    } else if (V <= 600 && Icc <= 35 && t <= 0.05) {
      categoria = 2; condicion = 'Switchgear ≤600 V, Icc ≤35 kA, t ≤0,05 s';
    } else if (V <= 600 && Icc <= 65 && t <= 0.07) {
      categoria = 4; condicion = 'Switchgear ≤600 V, Icc ≤65 kA, t ≤0,07 s';
    } else {
      // No cumplen tablas → instruir estudio IEEE 1584
      document.getElementById('result-display').style.display = 'block';
      document.getElementById('res_trab').innerText = trabajador;
      document.getElementById('res_fecha').innerText = fecha;
      document.getElementById('res_m').innerText  = 'NFPA 70E por tablas';
      document.getElementById('res_e').innerText  = '—';
      document.getElementById('res_eq').innerText = `Sistema ${V} V • Icc ${Icc} kA`;
      document.getElementById('res_t').innerText  = `${t.toFixed(3)} s`;
      document.getElementById('res_perm').innerText = permisosTxt;
      document.getElementById('res_cat').innerText = 'NO USAR TABLAS';
      document.getElementById('res_desc').innerHTML =
        "<b>No se puede usar el método de tablas con estos datos.</b><br>" +
        "Se requiere <b>estudio formal de arco eléctrico</b> (IEEE 1584) y etiquetado correspondiente.";
      const h = document.getElementById('et_h');
      h.innerText = "ADVERTENCIA";
      h.className = "et-head warning";
      window.scrollTo({ top: document.body.scrollHeight, behavior:'smooth' });
      return;
    }

    // Mostrar categoría asignada por tablas (NFPA)
    renderResult({
      trabajador, fecha,
      metodo:'NFPA 70E por tablas',
      energia:null,
      dist:`Condición de tabla: ${condicion}`,
      equipo:`Sistema ${V} V • Icc ${Icc} kA`,
      tiempo:t,
      cat:categoria,
      permisosTxt
    });
  }

  // ====== Utilidades ======
  function limpiar(){
    ['tag_id','volt_nfpa','scc_nfpa','t_nfpa'].forEach(id=>{
      const el=document.getElementById(id); if(el){ el.value=''; }
    });
    document.querySelectorAll('.rule-chk').forEach(c=>c.checked=false);
    document.getElementById('task_type').value='';
    document.getElementById('estudio_div').style.display='none';
    document.getElementById('stop_card').style.display='none';
    document.getElementById('result-display').style.display='none';
    window.scrollTo({ top: 0, behavior:'smooth' });
  }
</script>
</body>
</html>



